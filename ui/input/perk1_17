Manifest(perk for 1_17 manhunt, 7, by ItsGeomecraft)

#CONSTANTS
EFFECT_DEFAULT_LENGTH = 3

#some general purpose abstraction functions
def abstract forPerk(perkScore, runnable){
    execute as @a[scores={<perkScore>=1}] run execute at @s run <runnable>
}
def abstract link(function, waitTime){
    schedule function <function> <waitTime>
}

#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~mutual_hunt~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~#
namespace.set(mutual_hunt)

onLoad(scoreboard objectives add player dummy)

def store_player_position_into_storage(){
#player 1
execute as @a[scores={player=1},limit=1] at @s store result storage player1_coord X int 1 run data get entity @s Pos[0]
execute as @a[scores={player=1},limit=1] at @s store result storage player1_coord Y int 1 run data get entity @s Pos[1]
execute as @a[scores={player=1},limit=1] at @s store result storage player1_coord Z int 1 run data get entity @s Pos[2]
#player 2
execute as @a[scores={player=2},limit=1] at @s store result storage player2_coord X int 1 run data get entity @s Pos[0]
execute as @a[scores={player=2},limit=1] at @s store result storage player2_coord Y int 1 run data get entity @s Pos[1]
execute as @a[scores={player=2},limit=1] at @s store result storage player2_coord Z int 1 run data get entity @s Pos[2]
link(mutual_hunt:store_player_position_into_storage, 1t)
}

def compass_update(){
execute as @a[scores={player=1},nbt={Inventory:[{Slot:8b, id:"minecraft:compass",Count:1b}]},limit=1] run item modify entity @s container.8 mutual_hunt:compass_update_player1
execute as @a[scores={player=2},nbt={Inventory:[{Slot:8b, id:"minecraft:compass",Count:1b}]},limit=1] run item modify entity @s container.8 mutual_hunt:compass_update_player2
link(mutual_hunt:compass_update, 1t)
}

def compass_setup(){
    item modify entity @s container.8 mutual_hunt:compass_setup
}

def compass_lose_player(){
    #player1
    execute if entity @a[scores={player=2},nbt={Dimension:"minecraft:overworld"},limit=1] run execute as @a[scores={player=1},nbt={Inventory:[{Slot:8b, id:"minecraft:compass",Count:1b}]},limit=1] run item modify entity @s container.8 mutual_hunt:compass_overworld
    execute if entity @a[scores={player=2},nbt={Dimension:"minecraft:the_nether"},limit=1] run execute as @a[scores={player=1},nbt={Inventory:[{Slot:8b, id:"minecraft:compass",Count:1b}]},limit=1] run item modify entity @s container.8 mutual_hunt:compass_the_nether
    execute if entity @a[scores={player=2},nbt={Dimension:"minecraft:the_end"},limit=1] run execute as @a[scores={player=1},nbt={Inventory:[{Slot:8b, id:"minecraft:compass",Count:1b}]},limit=1] run item modify entity @s container.8 mutual_hunt:compass_the_end

    #player2
    execute if entity @a[scores={player=1},nbt={Dimension:"minecraft:overworld"},limit=1] run execute as @a[scores={player=2},nbt={Inventory:[{Slot:8b, id:"minecraft:compass",Count:1b}]},limit=1] run item modify entity @s container.8 mutual_hunt:compass_overworld
    execute if entity @a[scores={player=1},nbt={Dimension:"minecraft:the_nether"},limit=1] run execute as @a[scores={player=2},nbt={Inventory:[{Slot:8b, id:"minecraft:compass",Count:1b}]},limit=1] run item modify entity @s container.8 mutual_hunt:compass_the_nether
    execute if entity @a[scores={player=1},nbt={Dimension:"minecraft:the_end"},limit=1] run execute as @a[scores={player=2},nbt={Inventory:[{Slot:8b, id:"minecraft:compass",Count:1b}]},limit=1] run item modify entity @s container.8 mutual_hunt:compass_the_end
    link(mutual_hunt:compass_lose_player, 1t)
}

item.modifier.setNBT(compass_setup, tag, "<{LodestoneDimension:"minecraft:overworld",LodestoneTracked:0b,LodestonePos:{X:1,Y:1,Z:1}}>")
item.modifier.copyNBT(compass_update_player1, minecraft:player2_coord, X, LodestonePos.X, replace, Y, LodestonePos.Y, replace, Z, LodestonePos.Z, replace)
item.modifier.copyNBT(compass_update_player2, minecraft:player1_coord, X, LodestonePos.X, replace, Y, LodestonePos.Y, replace, Z, LodestonePos.Z, replace)

item.modifier.setNBT(compass_overworld, tag, "<{LodestoneDimension:"minecraft:overworld"}>")
item.modifier.setNBT(compass_the_nether, tag, "<{LodestoneDimension:"minecraft:the_nether"}>")
item.modifier.setNBT(compass_the_end, tag, "<{LodestoneDimension:"minecraft:the_end"}>")


#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~mutual_hunt~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~#
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~perk~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~#
#-----basic set up-----#
namespace.set(perk)

def basic_property_score_setup(){
    scoreboard objectives add health health
}
def scores_declare(){

    #Enhanced Resilience
    scoreboard objectives add en_re dummy

    #Holy Smite
    scoreboard objectives add ho_sm dummy

    #Fragmentation
    scoreboard objectives add frag dummy
}
onLoad(function perk:basic_property_score_setup, function perk:scores_declare)
#-----basic set up-----#
#-----actual perk-----#
def enhanced_resiliance_loop(){
    forPerk(en_re, execute if score @s health matches 10.. run effect give @s resistance >EFFECT_DEFAULT_LENGTH< 0 true)
    forPerk(en_re, execute if score @s health matches ..10 run effect give @s resistance >EFFECT_DEFAULT_LENGTH< 1 true)
    link(perk:enhanced_resiliance_loop, 1t)
}
def enhanced_resiliance(){
    function perk:enhanced_resiliance_loop
}

def 
#-----actual perk-----#
#-----starting function-----#
#starting function
def start(){
    #compass tracking
    function mutual_hunt:store_player_position_into_storage
    function mutual_hunt:compass_update
    function mutual_hunt:compass_lose_player

    #perk
    function perk:enhanced_resiliance
}
#-----starting function-----#
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~perk~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~#

onLand(spball, setblock ~ ~ ~ stone)
onLand(smite, summon minecraft:lightning_bolt ~ ~ ~)
onLand(dead, say Im dead)